---
import { useTranslations, getLocalizedPath, type Lang } from '@/i18n';
import LanguageSwitcher from './LanguageSwitcher.astro';
import SearchBar from './SearchBar.astro';

interface Props {
  lang: Lang;
  currentPage?: string;
  variant?: 'default' | 'portfolio' | 'minimal';
}

const { lang, currentPage = '', variant = 'default' } = Astro.props;
const t = useTranslations(lang);

const navItems = variant === 'portfolio'
  ? [
      { href: '#home', label: t('nav.home') },
      { href: '#about', label: t('nav.about') },
      { href: '#skills', label: t('nav.skills') },
      { href: '#projects', label: t('nav.projects') },
      { href: '#contact', label: t('nav.contact') },
    ]
  : [
      { href: getLocalizedPath(lang, '/'), label: t('nav.home') },
      { href: getLocalizedPath(lang, '/portfolio'), label: t('nav.portfolio') },
      { href: getLocalizedPath(lang, '/blog'), label: t('nav.blog') },
      { href: getLocalizedPath(lang, '/lab'), label: t('nav.lab') },
    ];

const isPortfolio = variant === 'portfolio';
---

{variant !== 'minimal' && (
  <nav class="navbar">
    <div class="navbar-content">
      <a href={getLocalizedPath(lang, '/')} class="text-xl font-bold font-heading text-primary">
        Alex
      </a>

      <!-- Desktop Navigation -->
      <div class="nav-links hidden md:flex">
        {navItems.map((item) => (
          <a
            href={item.href}
            class:list={[
              'nav-link',
              { 'active': currentPage === item.href }
            ]}
          >
            {item.label}
          </a>
        ))}
      </div>

      <div class="flex items-center gap-4">
        <SearchBar lang={lang} />
        <LanguageSwitcher currentLang={lang} class="hidden md:block" />

        <!-- Mobile Menu Toggle -->
        <button
          id="mobile-menu-toggle"
          class="hamburger md:hidden"
          aria-label={t('a11y.openMenu')}
          aria-expanded="false"
        >
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
    </div>
  </nav>

  <!-- Mobile Menu Overlay -->
  <div id="mobile-menu-overlay" class="mobile-menu-overlay"></div>

  <!-- Mobile Menu -->
  <div id="mobile-menu" class="mobile-menu">
    <button
      id="mobile-menu-close"
      class="absolute top-4 right-4 text-white text-3xl"
      aria-label={t('a11y.closeMenu')}
    >
      <i class="fas fa-times"></i>
    </button>

    <div class="flex flex-col items-center gap-6">
      {navItems.map((item) => (
        <a href={item.href} class="mobile-nav-link">
          {item.label}
        </a>
      ))}
      <LanguageSwitcher currentLang={lang} class="mt-4" />
    </div>
  </div>
)}

<script>
  const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
  const mobileMenu = document.getElementById('mobile-menu');
  const mobileMenuClose = document.getElementById('mobile-menu-close');
  const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');

  function openMobileMenu() {
    mobileMenu?.classList.add('active');
    mobileMenuOverlay?.classList.add('active');
    document.body.style.overflow = 'hidden';
    mobileMenuToggle?.setAttribute('aria-expanded', 'true');
  }

  function closeMobileMenu() {
    mobileMenu?.classList.remove('active');
    mobileMenuOverlay?.classList.remove('active');
    document.body.style.overflow = '';
    mobileMenuToggle?.setAttribute('aria-expanded', 'false');
  }

  mobileMenuToggle?.addEventListener('click', openMobileMenu);
  mobileMenuClose?.addEventListener('click', closeMobileMenu);
  mobileMenuOverlay?.addEventListener('click', closeMobileMenu);

  // Close menu on nav link click
  document.querySelectorAll('.mobile-nav-link').forEach((link) => {
    link.addEventListener('click', closeMobileMenu);
  });

  // Smooth scroll for anchor links
  document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();
      const targetId = (this as HTMLAnchorElement).getAttribute('href')?.substring(1);
      const targetElement = targetId ? document.getElementById(targetId) : null;

      if (targetElement) {
        closeMobileMenu();
        window.scrollTo({
          top: targetElement.offsetTop - 64,
          behavior: 'smooth',
        });
      }
    });
  });
</script>

<style>
  .mobile-menu-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 99;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
  }

  .mobile-menu-overlay.active {
    opacity: 1;
    visibility: visible;
  }

  .mobile-nav-link {
    color: white;
    font-size: 1.5rem;
    text-decoration: none;
    transition: color 0.3s ease;
  }

  .mobile-nav-link:hover {
    color: var(--accent-color);
  }

  .nav-link {
    position: relative;
    transition: color 0.3s ease;
  }

  .nav-link:hover,
  .nav-link.active {
    color: var(--accent-color);
  }

  .nav-link.active::after {
    content: '';
    position: absolute;
    bottom: -4px;
    left: 0;
    right: 0;
    height: 2px;
    background: var(--accent-color);
    border-radius: 1px;
  }
</style>
